<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HireMate Backend Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #5a67d8;
        }
        #result {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            white-space: pre-wrap;
            font-family: monospace;
        }
        input, textarea {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: none;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success { background: rgba(46, 160, 67, 0.8); }
        .error { background: rgba(220, 53, 69, 0.8); }
        .info { background: rgba(23, 162, 184, 0.8); }
    </style>
</head>
<body>
    <h1>ðŸ§ª HireMate Backend API Test</h1>
    
    <div class="container">
        <h2>Test Backend Connection</h2>
        <button onclick="testHealth()">Test Health Check</button>
        <button onclick="testDatabase()">Test Database</button>
        <button onclick="testAI()">Test AI (Groq)</button>
    </div>

    <div class="container">
        <h2>Test Authentication</h2>
        <input type="text" id="testEmail" placeholder="Email" value="test@example.com">
        <input type="password" id="testPassword" placeholder="Password" value="password123">
        <button onclick="testRegister()">Register User</button>
        <button onclick="testLogin()">Login User</button>
    </div>

    <div class="container">
        <h2>Test Chatbot (AI)</h2>
        <textarea id="chatMessage" placeholder="Enter your message..." rows="3">I have 3 years of experience in JavaScript and React. I love building web applications and solving complex problems.</textarea>
        <br>
        <button onclick="testChatbot()">Send to AI Bot</button>
    </div>

    <div class="container">
        <h2>Results</h2>
        <div id="status"></div>
        <div id="result"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000/api';
        let authToken = null;

        function setStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.className = `status ${type}`;
            statusDiv.textContent = message;
        }

        function setResult(data) {
            document.getElementById('result').textContent = JSON.stringify(data, null, 2);
        }

        async function apiCall(endpoint, options = {}) {
            const headers = {
                'Content-Type': 'application/json',
                ...options.headers
            };

            if (authToken) {
                headers.Authorization = `Bearer ${authToken}`;
            }

            try {
                const response = await fetch(`${API_BASE}${endpoint}`, {
                    ...options,
                    headers
                });

                const data = await response.json();
                
                if (response.ok) {
                    setStatus(`âœ… ${endpoint} - Success`, 'success');
                    setResult(data);
                    return data;
                } else {
                    setStatus(`âŒ ${endpoint} - Error: ${data.message}`, 'error');
                    setResult(data);
                    return null;
                }
            } catch (error) {
                setStatus(`âŒ ${endpoint} - Network Error: ${error.message}`, 'error');
                setResult({ error: error.message });
                return null;
            }
        }

        async function testHealth() {
            await fetch('http://localhost:5000/health')
                .then(response => response.json())
                .then(data => {
                    setStatus('âœ… Health Check - Server is running!', 'success');
                    setResult(data);
                })
                .catch(error => {
                    setStatus('âŒ Health Check - Server is not running', 'error');
                    setResult({ error: 'Make sure the backend server is running on port 5000' });
                });
        }

        async function testDatabase() {
            await fetch('http://localhost:3001/test-db')
                .then(response => response.json())
                .then(data => {
                    setStatus('âœ… Database Test - MongoDB connected!', 'success');
                    setResult(data);
                })
                .catch(error => {
                    setStatus('âŒ Database Test - Failed', 'error');
                    setResult({ error: 'Make sure MongoDB is connected and test server is running on port 3001' });
                });
        }

        async function testAI() {
            await fetch('http://localhost:3001/test-ai', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    message: 'I am a software developer with 3 years of experience'
                })
            })
                .then(response => response.json())
                .then(data => {
                    setStatus('âœ… AI Test - Groq API working!', 'success');
                    setResult(data);
                })
                .catch(error => {
                    setStatus('âŒ AI Test - Failed', 'error');
                    setResult({ error: 'Make sure Groq API key is correct and test server is running on port 3001' });
                });
        }

        async function testRegister() {
            const email = document.getElementById('testEmail').value;
            const password = document.getElementById('testPassword').value;
            
            const data = await apiCall('/auth/register', {
                method: 'POST',
                body: JSON.stringify({
                    name: 'Test User',
                    email: email,
                    password: password
                })
            });

            if (data && data.token) {
                authToken = data.token;
                setStatus('âœ… User registered and logged in!', 'success');
            }
        }

        async function testLogin() {
            const email = document.getElementById('testEmail').value;
            const password = document.getElementById('testPassword').value;
            
            const data = await apiCall('/auth/login', {
                method: 'POST',
                body: JSON.stringify({
                    email: email,
                    password: password
                })
            });

            if (data && data.token) {
                authToken = data.token;
                setStatus('âœ… User logged in successfully!', 'success');
            }
        }

        async function testChatbot() {
            if (!authToken) {
                setStatus('âŒ Please login first to test chatbot', 'error');
                return;
            }

            const message = document.getElementById('chatMessage').value;
            setStatus('ðŸ¤– Sending message to AI...', 'info');

            // Create interview session first
            const sessionData = await apiCall('/interview/sessions', {
                method: 'POST',
                body: JSON.stringify({
                    type: 'technical',
                    difficulty: 'medium',
                    jobRole: 'Software Engineer',
                    questionCount: 1
                })
            });

            if (sessionData && sessionData.success) {
                const sessionId = sessionData.session.sessionId;
                
                // Get session details to get the question
                const sessionDetails = await apiCall(`/interview/sessions/${sessionId}`);
                
                if (sessionDetails && sessionDetails.session.questions.length > 0) {
                    const question = sessionDetails.session.questions[0];
                    
                    // Submit answer
                    const answerData = await apiCall(`/interview/sessions/${sessionId}/answer`, {
                        method: 'POST',
                        body: JSON.stringify({
                            sessionId: sessionId,
                            questionId: question._id,
                            answer: message,
                            timeSpent: 60,
                            confidence: 4
                        })
                    });

                    if (answerData && answerData.success) {
                        setStatus('âœ… AI Analysis Complete!', 'success');
                        setResult({
                            question: question.question,
                            yourAnswer: message,
                            aiAnalysis: answerData.analysis
                        });
                    }
                }
            }
        }

        // Test health on page load
        window.onload = () => {
            testHealth();
        };
    </script>
</body>
</html>
